# Claude Code 公開・運用ガイド

## 0. はじめに

このガイドは **作ったアプリケーションを公開し、継続的に保守・改善するための自分用リファレンス** です。

- **想定読者**: プログラミング初心者 — [Claude Code アプリケーション開発ガイド](13-claude-code-app-dev-guide.md) を読み終え、Python スクリプトや簡単な Web アプリを作れる
- **ゴール**: README 整備・依存管理・デプロイ・CI/CD・保守サイクルを理解し、「作って終わり」から脱却する
- **関連ガイド**:
  - [Claude Code 応用・自動化ガイド](12-claude-code-advanced-guide.md) — カスタマイズ・自動化（レベル 3）
  - [Claude Code アプリケーション開発ガイド](13-claude-code-app-dev-guide.md) — アプリ開発（レベル 4）
  - [Claude Code スキル・プラグインガイド](15-claude-code-skills-guide.md) — スキル・プラグイン（次のステップ）

> レベル 4 までは **ローカル環境（自分の Mac の中）** で完結していた。
> このガイドでは、作ったものを **他の人が使える形にして公開し、維持・改善を続ける** ところまでをカバーする。

---

## 1. README とドキュメントを整備する

### README.md とは

プロジェクトの **「顔」**。GitHub でリポジトリを開いたとき最初に表示されるファイル。

アプリに付属する取扱説明書のようなもの。マークダウン形式なので、見出し・箇条書き・コードブロックなど表現力が豊か。

### 必須要素

```markdown
# プロジェクト名

プロジェクトの概要を 1〜2 文で。

## インストール

このプロジェクトを使い始めるための手順。

## 使い方

基本的な使用方法と実行例。

## 前提条件

必要なソフトウェアやバージョン。
```

### Claude Code に生成してもらう

```
あなた: 「このプロジェクトの README.md を作って。
        概要・インストール手順・使い方・前提条件を含めて」

Claude: プロジェクトの内容を確認して README.md を生成します...
```

> 自分で一から書くより、Claude Code に生成させて手直しする方が効率的。

---

## 2. 依存関係を管理する

### 依存関係とは

プロジェクトが動くために必要な外部パッケージのこと。

他のプログラマーが作った便利な機能（ライブラリ）を使うとき、「このプロジェクトはこれとこれを使っています」と明示しておかないと、他の環境で動かない。

### requirements.txt

プロジェクトが必要とするパッケージを一覧にしたファイル。

```bash
# 現在インストールされているパッケージを記録
pip freeze > requirements.txt
```

`requirements.txt` の中身:

```
pandas==2.2.0
openpyxl==3.1.2
flask==3.0.0
python-dotenv==1.0.0
```

### 他の環境で再現する

```bash
# requirements.txt からパッケージを一括インストール
pip install -r requirements.txt
```

### 仮想環境で隔離する

レベル 4 でも触れたが、改めて整理する。

```bash
# プロジェクトごとに仮想環境を作る
python -m venv .venv
source .venv/bin/activate

# パッケージをインストール
pip install -r requirements.txt
```

**重要**: `.venv/` フォルダは `.gitignore` に追加する（大量のファイルが含まれるため）。

```
あなた: 「依存関係を整理して requirements.txt を更新して。.gitignore に .venv を追加して」
```

---

## 3. GitHub でプロジェクトを公開する

### Private → Public

レベル 2 では GitHub をバックアップとして使った。ここではプロジェクトを **公開** する。

1. GitHub のリポジトリページを開く
2. Settings → General → 「Danger Zone」セクション
3. 「Change visibility」→ 「Make public」

> 公開前に `.env` などの秘密情報が含まれていないか必ず確認する。

### ライセンスの選び方

公開するなら **ライセンス**（他の人がどう使ってよいかのルール）を付ける。

| ライセンス | 特徴 | 選ぶ基準 |
|-----------|------|---------|
| **MIT** | 最も自由。誰でも自由に使える | 迷ったらこれ |
| **Apache 2.0** | MIT に近いが、特許に関する条項がある | 企業利用を想定する場合 |
| **GPL** | 改変したら同じライセンスで公開する義務 | コードの公開を義務づけたい場合 |

```
あなた: 「MIT ライセンスの LICENSE ファイルを作って」
```

### Issue でフィードバックを管理する

GitHub の **Issue** 機能は、改善要望やバグ報告を記録・管理する仕組み。

- 自分用のタスク管理としても使える
- 「何を直すべきか」を明文化しておくと、後から対応しやすい

```bash
# GitHub CLI で Issue を作成
gh issue create --title "CSV のヘッダーが日本語だと文字化けする" --body "UTF-8 以外のエンコーディングに対応する"

# Issue 一覧を表示
gh issue list
```

---

## 4. 環境変数と秘密情報の管理

### なぜ重要か

API キーやパスワードをコードに直書きすると、GitHub に公開した瞬間 **世界中から見えてしまう**。実際にこの事故は頻繁に起きている。

### 管理方法のまとめ

```
.env（秘密情報を書く）     → .gitignore に追加（Git に含めない）
.env.example（項目名だけ）  → Git に含める（何が必要かを示す）
```

`.env`:

```
API_KEY=sk-abc123-actual-secret-key
DATABASE_URL=postgresql://user:password@localhost/mydb
```

`.env.example`:

```
API_KEY=your-api-key-here
DATABASE_URL=your-database-url-here
```

> `.env.example` は「このプロジェクトにはこういう環境変数が必要です」という説明書。実際の値は入れない。

### Claude Code への指示

```
あなた: 「.env と .env.example を作って。API_KEY と DATABASE_URL を管理するようにして。
        .gitignore に .env を追加して」
```

---

## 5. デプロイの基本概念

### デプロイとは

「自分の Mac で動いている」状態から「いつでも誰でもアクセスできる」状態にすること。

自分のパソコンから、インターネット上のサーバーにアプリを置くイメージ。そうすれば世界中どこからでもアクセスできる。

### 選択肢の概観

| 種類 | 代表的なサービス | 向いているもの | 難易度 |
|------|---------------|-------------|--------|
| **静的サイト** | GitHub Pages | HTML/CSS/JS のみのサイト | 低 |
| **Web アプリ** | Streamlit Cloud, Render | Python バックエンドあり | 中 |
| **スクリプト配布** | GitHub Releases, PyPI | コマンドラインツール | 低〜中 |

### 最も手軽: Streamlit Cloud

レベル 4 で Streamlit アプリを作った場合、最も簡単にデプロイできる。

1. コードを GitHub に push
2. `https://share.streamlit.io` にアクセス
3. GitHub リポジトリを選択
4. 「Deploy」をクリック

```
あなた: 「このプロジェクトを Streamlit Cloud にデプロイする準備をして。
        必要なファイル（requirements.txt など）が揃っているか確認して」
```

### GitHub Pages（静的サイト）

HTML/CSS/JS だけのサイトなら、GitHub Pages で無料公開できる。

1. リポジトリの Settings → Pages
2. Source で「main」ブランチを選択
3. 「Save」をクリック
4. 数分後に `https://ユーザー名.github.io/リポジトリ名/` でアクセスできる

### Render（本格的な Web アプリ）

Flask アプリなど Python バックエンドが必要な場合:

1. `https://render.com` でアカウント作成
2. 「New Web Service」→ GitHub リポジトリを接続
3. ビルドコマンドとスタートコマンドを設定
4. 「Create Web Service」で公開

```
あなた: 「この Flask アプリを Render にデプロイするための設定ファイルを作って」
```

> 完璧を目指さず、まず最小限で公開する。改善は後からいくらでもできる。

---

## 6. CI/CD — 自動テスト・自動デプロイ

### CI/CD とは

| 用語 | 意味 | やること |
|------|------|---------|
| **CI**（継続的インテグレーション） | コードを変更するたびに自動でテストを実行 | push → 自動テスト |
| **CD**（継続的デリバリー/デプロイ） | テストに通ったら自動でデプロイ | テスト合格 → 自動公開 |

### GitHub Actions

GitHub に組み込まれた CI/CD サービス。設定ファイルを置くだけで使える。

### 最小構成: push したらテストを自動実行

```
あなた: 「GitHub Actions で、push するたびに pytest を自動実行するワークフローを作って」
```

Claude Code が作成するファイル:

`.github/workflows/test.yml`:

```yaml
name: テスト実行

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - run: pip install -r requirements.txt
      - run: pytest tests/ -v
```

この設定により:
- `main` ブランチに push するたびにテストが自動実行される
- プルリクエストを作成したときもテストが走る
- テストが失敗すると GitHub 上で通知される

### GitHub Actions の結果を確認する

GitHub のリポジトリページ → 「Actions」タブで実行結果を確認できる。

---

## 7. 保守と改善のサイクル

### Issue 駆動の開発

「何を直すか」を Issue に記録 → ブランチを切って修正 → プルリクエスト → マージ。

```
1. Issue を作成: 「CSVのヘッダーが日本語だと文字化けする」
2. ブランチを作成: git checkout -b fix/csv-encoding
3. 修正を実装
4. テストを追加・実行
5. コミット → push → プルリクエスト
6. マージ → Issue をクローズ
```

> 個人開発でも、この流れを習慣にすると「何を変えたか」「なぜ変えたか」の記録が自然に残る。

### バージョニング

リリースにバージョン番号をつける習慣。

```
v1.0.0  →  v1.1.0  →  v1.1.1  →  v2.0.0
```

| 番号の位置 | 意味 | 例 |
|-----------|------|-----|
| **メジャー**（v**1**.0.0） | 互換性のない大きな変更 | API の仕様変更 |
| **マイナー**（v1.**1**.0） | 後方互換のある機能追加 | 新しいコマンドの追加 |
| **パッチ**（v1.1.**1**） | バグ修正 | 文字化けの修正 |

```bash
# GitHub CLI でリリースを作成
gh release create v1.0.0 --title "v1.0.0 初回リリース" --notes "初回リリース"
```

### 定期的な保守

```
あなた: 「依存パッケージに既知の脆弱性がないか確認して」
あなた: 「未使用のコードやインポートを整理して」
あなた: 「requirements.txt のパッケージを最新バージョンに更新して」
```

> Claude Code は保守作業のパートナーとしても優秀。定期的に依頼するだけで、プロジェクトの健全性を維持できる。

---

## 8. プロジェクト管理の全体像

### 開発サイクル

レベル 1〜5 で学んだことを俯瞰すると、1 つのサイクルになる。

```
企画 → 設計 → 実装 → テスト → 公開 → 運用 → 改善
 ↑                                            │
 └──────────────────────────────────────────────┘
```

### 各段階で Claude Code がどう支援するか

| 段階 | Claude Code への依頼例 |
|------|---------------------|
| 企画 | 「こういうツールを作りたい。どういう技術が必要？」 |
| 設計 | 「プロジェクト構成を提案して」（プランモード） |
| 実装 | 「この機能を実装して」（段階的に） |
| テスト | 「テストを書いて実行して」 |
| 公開 | 「README を作って」「デプロイの設定をして」 |
| 運用 | 「エラーの原因を調査して」「依存パッケージを更新して」 |
| 改善 | 「この機能をリファクタリングして」 |

### 「一人開発」のミニマムフロー

完璧を目指す必要はない。以下の最低限の習慣があれば十分:

1. **Git でこまめにコミット** — いつでも戻れる安心感
2. **GitHub に push** — バックアップと変更履歴の公開
3. **README を書く** — 未来の自分への説明書
4. **テストを書く** — 壊れたらすぐわかる仕組み

---

## 9. 困ったときは

### よくある問題と対処法

| 症状 | 対処法 |
|------|--------|
| デプロイ先でアプリが動かない | ログを確認。`requirements.txt` に不足がないか確認 |
| GitHub Actions が失敗する | Actions タブでエラーログを確認。Claude Code に「このエラーの原因を調べて」と依頼 |
| `.env` を誤って Git にコミットした | すぐに API キーを無効化・再発行。`git rm --cached .env` で追跡を解除してコミット |
| Streamlit Cloud でデプロイエラー | `requirements.txt` の形式を確認。Python バージョンの指定が必要な場合がある |
| 何から手をつけていいかわからない | Claude Code に「このプロジェクトを公開するために必要な作業を一覧にして」と依頼 |
