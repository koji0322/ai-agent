# Claude Code 実践ガイド

## 0. はじめに

このガイドは **Claude Code を実際のプロジェクトで活用するための自分用リファレンス** です。

- **想定読者**: [Claude Code 基本操作ガイド](01-claude-code-guide.md) を読み終え、基本操作はできる
- **ゴール**: Git による変更管理、GitHub でのコード保管、実践的な開発フローを身につける
- **関連ガイド**:
  - [VS Code 基本操作ガイド](00-vscode-guide.md) — VS Code の使い方と Claude Code 連携
  - [Claude Code 応用・自動化ガイド](03-claude-code-advanced-guide.md) — カスタマイズと自動化（次のステップ）

> レベル 1 は「道具の使い方を覚える」段階だった。
> このガイドでは **「道具を使って実際に仕事をする」** 段階に進む。

---

## 1. Git でバージョン管理する

### Git とは何か

Git は **ファイルの変更履歴を記録・管理するツール**。

VBA で開発していると、こんなファイルが増えていく:

```
売上集計マクロ_v1.xlsm
売上集計マクロ_v2.xlsm
売上集計マクロ_v2_修正版.xlsm
売上集計マクロ_v2_修正版_最終.xlsm
売上集計マクロ_v2_修正版_本当の最終.xlsm
```

Git を使えば、**ファイルは 1 つのまま、変更の履歴だけを記録できる**。ゲームの「セーブポイント」のようなもので、いつでも過去の状態に戻れる。

### Git のインストール確認

```bash
git --version
```

バージョン番号（例: `git version 2.43.0`）が表示されれば OK。
「command not found」と出た場合:

```bash
# Xcode Command Line Tools と一緒にインストールされる
xcode-select --install
```

### 最低限の初期設定

初回のみ、名前とメールアドレスを設定する。

```bash
git config --global user.name "自分の名前"
git config --global user.email "自分のメールアドレス"
```

### 基本の 3 コマンド

Git の操作は、この 3 つだけで始められる。

| コマンド | 意味 | VBA で例えると |
|---------|------|---------------|
| `git init` | このフォルダを Git で管理し始める | 新しいブックを作成する |
| `git add ファイル名` | 変更を「次のセーブ」に含める準備 | 保存したいシートを選ぶ |
| `git commit -m "説明"` | 変更を記録する（セーブポイントを作る） | `Ctrl + S` で保存する |

### 実際にやってみる

```bash
# プロジェクトフォルダに移動
cd ~/Documents/my-project

# Git で管理を開始
git init

# ファイルを作成（例）
echo "print('Hello')" > main.py

# 変更をステージング（セーブ対象に含める）
git add main.py

# コミット（セーブポイントを作る）
git commit -m "最初のコミット: main.py を作成"
```

> **コミットメッセージ**（`-m` の後の文字列）は「何をしたか」を簡潔に書く。
> 後から履歴を見返したときに、どの変更が何のためだったかわかるようにする。

### 履歴を確認する

```bash
# コミット履歴を一覧表示
git log --oneline
```

出力例:

```
a1b2c3d 最初のコミット: main.py を作成
```

### 変更内容を確認する

```bash
# まだコミットしていない変更を表示
git diff
```

> VBA では「前の状態」を覚えておくしかなかったが、`git diff` を使えば **何がどう変わったかを正確に確認できる**。

### 過去の状態に戻す

間違えたファイルを元に戻したいとき:

```bash
# 特定のファイルを最後のコミット時点に戻す
git restore ファイル名
```

> 「元に戻す」が無限に効く `Cmd + Z` のようなもの。ただし **コミットしていない変更は戻せない** ので、こまめにコミットすることが大事。

### Claude Code に Git 操作を任せる

Git コマンドを覚えなくても、Claude Code に頼める。

```
あなた: 「今の変更をコミットして。メッセージは『ログイン機能を追加』で」

Claude: git add と git commit を実行します。
        → 承認しますか？ [y/n]

あなた: y
```

---

## 2. GitHub でコードを保管する

### GitHub とは

GitHub は **Git のリポジトリ（プロジェクト）をインターネット上に保管するサービス**。

| ローカル Git だけ | GitHub を使う |
|-----------------|-------------|
| 自分の Mac の中だけに履歴がある | インターネット上にもコピーがある |
| Mac が壊れたら全部なくなる | Mac が壊れてもコードは残る |
| 自分しか見られない | 他の人と共有もできる |

> iCloud や OneDrive でファイルをバックアップするのと似ているが、GitHub は **変更履歴ごとバックアップされる**。

### アカウント作成

1. ブラウザで `https://github.com` にアクセス
2. 「Sign up」からアカウントを作成
3. メール認証を完了

### SSH キーの設定

GitHub にコードを送るには、自分の Mac と GitHub の間に「鍵」を設定する必要がある。Claude Code に手伝ってもらうのが簡単。

```
あなた: 「GitHub に SSH 接続するための設定をして」

Claude: SSH キーを生成して GitHub に登録する手順を案内します...
```

Claude が生成した公開鍵を GitHub の Settings → SSH and GPG keys に登録する。

### リポジトリの作成と push

```bash
# GitHub にリポジトリを作成（GitHub の Web サイトで「New repository」）
# リポジトリ名を入力して「Create repository」をクリック

# ローカルのプロジェクトと GitHub を紐づける
git remote add origin git@github.com:ユーザー名/リポジトリ名.git

# ローカルの履歴を GitHub に送る
git push -u origin main
```

> この操作も Claude Code に「GitHub にリポジトリを作って push して」と頼める。

### 基本フロー

日常的な作業の流れ:

```
コードを編集 → git add → git commit → git push
```

1. ローカルで作業する
2. 区切りのいいところでコミット（セーブポイント）
3. push で GitHub にバックアップ

---

## 3. プロジェクトの始め方

### ゼロからプロジェクトを立ち上げる

レベル 1 では「既にあるフォルダで `claude` を起動する」だけだった。ここではゼロから始める。

```bash
# プロジェクトフォルダを作成
mkdir ~/Documents/my-new-project
cd ~/Documents/my-new-project

# Git で管理を開始
git init

# Claude Code を起動
claude
```

### フォルダ構成の考え方

| VBA の場合 | プロジェクトの場合 |
|-----------|---------------|
| 1 つの `.xlsm` ファイルに全部入り | 役割ごとにファイルを分ける |
| 標準モジュールにコードがずらっと並ぶ | `src/`（ソースコード）、`tests/`（テスト）など |

Claude Code に雛形を作らせると楽:

```
あなた: 「Python で CSV を集計するプロジェクトの雛形を作って」

Claude: 以下の構成で作成します。
        my-new-project/
          src/
            main.py
          tests/
            test_main.py
          requirements.txt
          README.md
        → 承認しますか？ [y/n]
```

### CLAUDE.md を最初に整備する

プロジェクトを始めたら、まず `CLAUDE.md` を作っておくと後が楽になる。

```
あなた: 「このプロジェクトの CLAUDE.md を作って。Python 3.12 を使い、CSV の集計処理を行うプロジェクトだということを書いて」
```

> レベル 1 で学んだ `/init` コマンドでの自動生成も使える。

### .gitignore の役割

Git で管理する **必要のないファイル** を指定するファイル。

```
# .gitignore の例
__pycache__/       # Python が自動生成するキャッシュ
.env               # API キーなどの秘密情報
*.pyc              # コンパイル済みファイル
.DS_Store          # macOS が自動生成するファイル
```

> VBA では気にする必要がなかったが、プロジェクト開発では「管理すべきファイル」と「管理しなくてよいファイル」を分ける必要がある。
> Claude Code に「.gitignore を作って」と頼めば、プロジェクトに合った内容を生成してくれる。

---

## 4. 実践的な開発フロー

レベル 1 の「指示 → 提案 → 承認」をより実践的なワークフローに発展させる。

### 5 つのフェーズ

```
調査 → 計画 → 実装 → 確認 → 記録
```

### フェーズ 1: 調査

まずプロジェクトの現状を把握する。いきなり「直して」と言うより精度が上がる。

```
あなた: 「このプロジェクトの構成を説明して」
あなた: 「login に関するファイルを探して」
あなた: 「エラーの原因を調査して」
```

### フェーズ 2: 計画

プランモード（`/plan`）を使って、実装方針を先に立てる。

```
あなた: /plan
あなた: 「ログイン機能にパスワードリセット機能を追加したい。どう実装すべきか計画を立てて」

Claude: 以下の計画を提案します。
        1. パスワードリセット用のメール送信機能を追加
        2. リセットトークンの生成と検証
        3. 新しいパスワードの設定画面
        ...
```

> プランモードでは Claude は **読み取りだけ行い、ファイルを変更しない**。安心して計画を練れる。

### フェーズ 3: 実装

計画に沿って、段階的に指示を出す。

```
あなた: 「計画のステップ 1 を実装して」

Claude: （変更内容が表示される）
        → 承認しますか？ [y/n]
```

**ポイント**: 一度に全部やらせず、ステップごとに確認する。大きな変更ほど小分けにする。

### フェーズ 4: 確認

実装したコードが正しく動くか確認する。

```
あなた: 「今の変更が正しく動くかテストして」
あなた: 「main.py を実行して動作確認して」
```

### フェーズ 5: 記録

動作確認が済んだら Git でコミットする。

```
あなた: 「今の変更をコミットして。メッセージは『パスワードリセット機能のメール送信を追加』で」
```

### 通しの具体例: CSV 集計スクリプトを作る

実際に 5 フェーズを通しで体験する例:

```
# フェーズ 1: 調査
あなた: 「data フォルダに CSV ファイルがある。中身を確認して」

# フェーズ 2: 計画
あなた: /plan
あなた: 「この CSV の月ごとの売上合計を集計するスクリプトを作りたい。計画を立てて」

# フェーズ 3: 実装
あなた: （プランモード解除後）「計画に沿って実装して」

# フェーズ 4: 確認
あなた: 「スクリプトを実行して結果を見せて」

# フェーズ 5: 記録
あなた: 「変更をコミットして」
```

---

## 5. 拡張思考モードを使う

### 拡張思考モードとは

Claude に **より深く、より長く考えさせる** モード。通常モードでは素早く回答するが、拡張思考モードでは時間をかけて複雑な問題に取り組む。

切り替え: `Alt + T`（セッション中に押す）

### どんなときに使うか

| シーン | 通常モード | 拡張思考モード |
|-------|----------|-------------|
| 簡単な質問・小さな修正 | ○ | △（時間がかかるだけ） |
| 複雑なバグの原因調査 | △ | ○ |
| 設計の判断（どう実装すべきか） | △ | ○ |
| 大規模なリファクタリング方針 | △ | ○ |
| コードの説明を聞く | ○ | △ |

> **迷ったら通常モードで始めて、回答の精度が足りないと感じたら拡張思考モードに切り替える**、でよい。

---

## 6. 複数ファイルにまたがる作業

### VBA との違い

VBA では 1 つの標準モジュールに数百行のコードを書くことが多い。実際のプロジェクトでは、機能ごとにファイルを分けるのが普通。

```
my-project/
  src/
    main.py         # メインの処理
    data_loader.py  # データ読み込み
    calculator.py   # 計算ロジック
    report.py       # レポート出力
  tests/
    test_calculator.py
```

### Claude Code は複数ファイルを横断的に扱える

```
あなた: 「src フォルダ内の全ファイルを確認して、各ファイルの役割を説明して」

あなた: 「calculator.py の集計ロジックを修正して、関連する test_calculator.py のテストも更新して」
```

Claude Code はプロジェクト全体を見渡して、関連するファイルをまとめて修正できる。

### 変更が多いときはプランモードを使う

複数ファイルを同時に変更する場合、先にプランモードで方針を確認すると安全。

```
あなた: /plan
あなた: 「data_loader.py を CSV だけでなく Excel ファイルにも対応させたい。影響範囲を調べて計画を立てて」

Claude: 以下のファイルに変更が必要です。
        1. data_loader.py — Excel 読み込み機能を追加
        2. main.py — ファイル形式の判定ロジックを追加
        3. requirements.txt — openpyxl パッケージを追加
        4. tests/test_data_loader.py — Excel 用のテストを追加
```

---

## 7. エラーとデバッグ

### VBA のデバッグとの違い

| VBA のデバッグ | Claude Code でのデバッグ |
|--------------|----------------------|
| `F8` でステップ実行して変数を確認 | エラーメッセージを Claude に渡して原因を調べてもらう |
| ウォッチウィンドウで変数を監視 | 「この変数の値を表示して」と指示 |
| 手動でブレークポイントを設定 | Claude が自動で問題箇所を特定 |

### エラーメッセージをそのまま渡す

ターミナルに表示されたエラーメッセージをコピーして、Claude Code に貼り付けるだけでよい。

```
あなた: 「以下のエラーが出た。原因を調べて修正して」

Traceback (most recent call last):
  File "main.py", line 12, in <module>
    result = calculate_total(data)
TypeError: calculate_total() missing 1 required positional argument: 'tax_rate'

Claude: エラーの原因を分析します...
        原因: calculate_total 関数に tax_rate 引数が追加されていますが、
        呼び出し側が対応していません。
        修正案を提案します。（変更内容が表示される）
```

### スクリーンショットを渡す

ブラウザのエラー画面やアプリの見た目の問題は、スクリーンショットを貼り付けることもできる。

```
Ctrl + V（または Cmd + V）
```

でクリップボードの画像を Claude Code のセッションに貼り付けられる。

### 「何が起きているか」を具体的に伝える

```
× 「動かない」
○ 「main.py を実行すると 12 行目で TypeError が出る。引数が足りないと言われている」

× 「表示がおかしい」
○ 「ブラウザでページを開くとヘッダーが画面左に寄ってしまう。中央揃えにしたい」
```

---

## 8. 困ったときは

### よくある問題と対処法

| 症状 | 対処法 |
|------|--------|
| `git: command not found` | `xcode-select --install` で Git をインストール |
| `git push` で認証エラー | SSH キーの設定を確認。Claude Code に「SSH の設定を確認して」と依頼 |
| コミットを間違えた（メッセージを直したい） | `git commit --amend -m "正しいメッセージ"` で直前のコミットを修正 |
| 間違えてコミットしたファイルを取り消したい | Claude Code に「直前のコミットから○○ファイルを除外して」と依頼 |
| `git push` できない（リモートに新しい変更がある） | `git pull` で最新の変更を取り込んでから再度 `git push` |
| 変更を全部なかったことにしたい | `git restore .` で全ファイルを最後のコミットに戻す（未コミットの変更は消える） |
| プランモードの解除方法がわからない | `Shift + Tab` でパーミッションモードを切り替える |

### Git で迷ったら Claude Code に聞く

Git の操作は Claude Code が得意とする分野。困ったときは状況を説明して相談するのが最も早い。

```
あなた: 「git の状態がよくわからなくなった。現状を確認して、何をすべきか教えて」

Claude: git status を実行して現状を確認します...
```
